function handleResize(){var e=$("#google-map").outerHeight();$(".modal-content").css({height:e+"px"})}function makeDoubleSlider(){$("#slider").children().length>0&&$("#slider").slider("destroy"),$("#slider").slider({range:!0,min:1980,max:2015,values:[2e3,2014],slide:function(e,t){yearfrom=t.values[0],yearto=t.values[1],makeSentence(),$("#slider").find(".ui-slider-handle").first(),$("#slider").find(".ui-slider-handle").last()},create:function(e,t){yearfrom=2e3,yearto=2014,makeSentence(),$("#slider").find(".ui-slider-handle").first(),$("#slider").find(".ui-slider-handle").last()}})}function makeSingleSlider(){$("#slider").children().length>0&&$("#slider").slider("destroy"),$("#slider").slider({min:1980,max:2015,value:2014,slide:function(e,t){yearfrom=t.value,yearto=t.value,makeSentence(),$("#slider").find(".ui-slider-handle").first()},create:function(e,t){yearfrom=t.value,yearto=t.value,makeSentence(),$("#slider").find(".ui-slider-handle").first()}})}function makeSentence(){var e="Votre recherche actuelle liste les films";yearfrom>0&&(e+=yearto>0?yearfrom==yearto?" en "+yearfrom:" entre "+yearfrom+" et "+yearto:" en "+yearfrom),category>0&&($categoryName=$("#category-selector-"+category).text(),e+=" dans la catÃ©gorie "+$categoryName),e+=".",$("#sentence").text(e),getCards()}function getCards(){$parameters={count:0},"undefined"!=typeof category&&category>0&&$.extend($parameters,{category:category}),"undefined"!=typeof lattop&&lattop>0&&$.extend($parameters,{lattop:lattop}),"undefined"!=typeof lngtop&&lngtop>0&&$.extend($parameters,{lngtop:lngtop}),"undefined"!=typeof latbottom&&latbottom>0&&$.extend($parameters,{latbottom:latbottom}),"undefined"!=typeof category&&category>0&&$.extend($parameters,{category:category}),"undefined"!=typeof lngbottom&&lngbottom>0&&$.extend($parameters,{lngbottom:lngbottom}),"undefined"!=typeof yearfrom&&yearfrom>0&&$.extend($parameters,{yearfrom:yearfrom}),"undefined"!=typeof yearto&&yearto>0&&$.extend($parameters,{yearto:yearto}),"undefined"!=typeof movietype&&0!=movietype&&$.extend($parameters,{movietype:movietype});var e,t;$.get("/rest/cards",$parameters,function(o){if(mapMarkers.length>0)for(t=0;t<mapMarkers.length;t++)mapMarkers[t].setMap(null);mapMarkers=[],markers=[],infowindows=[],hcData=[],$.each(o.cards,function(e,t){markers.push([t.title,t.location_lat,t.location_long]),cardIDs.push([t.id]),infowindows.push(['<h2><a class="slideRight" href="/cards/'+t.id+'">'+t.title+"</a></h2><p>"+t.description+"</p>"])});var a=new google.maps.InfoWindow;for(t=0;t<markers.length;t++){var n=new google.maps.LatLng(markers[t][1],markers[t][2]);hcData.push(n),bounds.extend(n),e=new google.maps.Marker({position:n,map:map,title:markers[t][0],icon:"assets/img/zoom-0.png"}),mapMarkers.push(e),google.maps.event.addListener(e,"click",function(e,t){return function(){href="/cards/"+cardIDs[t],$("#slideRight .modal-body").load(href+" #content"),$("#slideRight").modal()}}(e,t)),"undefined"!=typeof map&&map.fitBounds(bounds)}var r={gridSize:50,maxZoom:15,styles:[{height:40,url:"assets/img/zoom-1.png",width:40},{height:56,url:"assets/img/zoom-2.png",width:56},{height:66,url:"assets/img/zoom-3.png",width:66},{height:78,url:"assets/img/zoom-4.png",width:78},{height:90,url:"assets/img/zoom-5.png",width:90}]};"undefined"!=typeof markerCluster&&markerCluster.clearMarkers(),"undefined"!=typeof MarkerClusterer&&"undefined"!=typeof map&&(markerCluster=new MarkerClusterer(map,mapMarkers,r),google.maps.event.addListener(markerCluster,"clusterclick",function(e){if(map.getZoom()>12){var t=e.getMarkers(),o="<ul>",a="";$.each(t,function(){m=$(this)[0];var e=$(mapMarkers).index(this),t=infowindows[e];o+="<li>"+t+"</li>",$("#slideRight .modal-body").html(o),$("#slideRight").modal()})}}))})}(function(){var e;e=window.jQuery||window.Zepto||window.$,e.fn.fancySelect=function(t){var o,a;return null==t&&(t={}),a=e.extend({forceiOS:!1,includeBlank:!1,optionTemplate:function(e){return e.text()},triggerTemplate:function(e){return e.text()}},t),o=!!navigator.userAgent.match(/iP(hone|od|ad)/i),this.each(function(){var t,n,r,i,l,s,d;return i=e(this),i.hasClass("fancified")||"SELECT"!==i[0].tagName?void 0:(i.addClass("fancified"),i.css({width:1,height:1,display:"block",position:"absolute",top:0,left:0,opacity:0}),i.wrap('<div class="fancy-select">'),d=i.parent(),i.data("class")&&d.addClass(i.data("class")),d.append('<div class="trigger">'),(!o||a.forceiOS)&&d.append('<ul class="options">'),l=d.find(".trigger"),r=d.find(".options"),n=i.prop("disabled"),n&&d.addClass("disabled"),s=function(){var e;return e=a.triggerTemplate(i.find(":selected")),l.html(e)},i.on("blur.fs",function(){return l.hasClass("open")?setTimeout(function(){return l.trigger("close.fs")},120):void 0}),l.on("close.fs",function(){return l.removeClass("open"),r.removeClass("open")}),l.on("click.fs",function(){var t,s;if(!n)if(l.toggleClass("open"),o&&!a.forceiOS){if(l.hasClass("open"))return i.focus()}else if(l.hasClass("open")&&(s=l.parent(),t=s.offsetParent(),s.offset().top+s.outerHeight()+r.outerHeight()+20>e(window).height()+e(window).scrollTop()?r.addClass("overflowing"):r.removeClass("overflowing")),r.toggleClass("open"),!o)return i.focus()}),i.on("enable",function(){return i.prop("disabled",!1),d.removeClass("disabled"),n=!1,t()}),i.on("disable",function(){return i.prop("disabled",!0),d.addClass("disabled"),n=!0}),i.on("change.fs",function(e){return e.originalEvent&&e.originalEvent.isTrusted?e.stopPropagation():s()}),i.on("keydown",function(e){var t,o,a;if(a=e.which,t=r.find(".hover"),t.removeClass("hover"),r.hasClass("open")){if(38===a?(e.preventDefault(),t.length&&t.index()>0?t.prev().addClass("hover"):r.find("li:last-child").addClass("hover")):40===a?(e.preventDefault(),t.length&&t.index()<r.find("li").length-1?t.next().addClass("hover"):r.find("li:first-child").addClass("hover")):27===a?(e.preventDefault(),l.trigger("click.fs")):13===a||32===a?(e.preventDefault(),t.trigger("click.fs")):9===a&&l.hasClass("open")&&l.trigger("close.fs"),o=r.find(".hover"),o.length)return r.scrollTop(0),r.scrollTop(o.position().top-12)}else if(13===a||32===a||38===a||40===a)return e.preventDefault(),l.trigger("click.fs")}),r.on("click.fs","li",function(t){var a;return a=e(this),i.val(a.data("raw-value")),o||i.trigger("blur.fs").trigger("focus.fs"),r.find(".selected").removeClass("selected"),a.addClass("selected"),l.addClass("selected"),i.val(a.data("raw-value")).trigger("change.fs").trigger("blur.fs").trigger("focus.fs")}),r.on("mouseenter.fs","li",function(){var t,o;return o=e(this),t=r.find(".hover"),t.removeClass("hover"),o.addClass("hover")}),r.on("mouseleave.fs","li",function(){return r.find(".hover").removeClass("hover")}),t=function(){var t;return s(),!o||a.forceiOS?(t=i.find("option"),i.find("option").each(function(t,o){var n;return o=e(o),o.prop("disabled")||!o.val()&&!a.includeBlank?void 0:(n=a.optionTemplate(o),r.append(o.prop("selected")?'<li data-raw-value="'+o.val()+'" class="selected">'+n+"</li>":'<li data-raw-value="'+o.val()+'">'+n+"</li>"))})):void 0},i.on("update.fs",function(){return d.find(".options").empty(),t()}),t())})}}).call(this);var category=0,yearfrom=0,yearto=0,lattop=0,lngtop=0,latbottom=0,lngbottom=0,movietype=0,map,markers=[],mapMarkers=[],cardIDs=[],infowindows,bounds=new google.maps.LatLngBounds,mapOptions={mapTypeId:"roadmap"},heatmap,hcData=[],markerCluster;jQuery(function(){var e=[{stylers:[{visibility:"simplified"}]},{stylers:[{color:"#121212"}]},{featureType:"water",stylers:[{color:"#121212"},{lightness:0}]},{featureType:"landscape",stylers:[{color:"#121212"},{lightness:35}]},{elementType:"labels.text.fill",stylers:[{visibility:"on"},{lightness:100}]}];$(".custom-select").fancySelect();var t=new google.maps.LatLng(50.833,4.333);if($("#google-map").length&&(map=new google.maps.Map(document.getElementById("google-map"),{zoom:4,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:0,zoomControl:!0,mapTypeControl:0,maxZoom:13,scaleControl:!0,streetViewControl:0,styles:e,overviewMapControl:0})),$(document).on("click",".ajax",function(e){e.preventDefault();var t=$(this);return href=t.attr("href"),$("#ajax .modal-body").load(href+" #content"),$("#ajax").modal(),$(this).animate({left:"-50%"},500,function(){$(this).css("left","150%"),$(this).appendTo("#container")}),$(this).next().animate({left:"50%"},500),!1}),$(document).on("click",".slideRight",function(e){var t=$(this);return href=t.attr("href"),$("#slideRight .modal-body").load(href+" #content"),$("#slideRight").modal(),$("#slideRight").animate({left:"-50%"},500,function(){$("#slideRight").css("left","150%"),$("#slideRight").appendTo("#container")}),$("#slideRight").next().animate({left:"50%"},500),!1}),$(document).on("click",".addCard",function(e){return e.preventDefault(),$("#addCard").modal(),!1}),$(document).on("change, change.fs","#category-selector",function(e){var t=$(this);category=t.val(),makeSentence()}),$(document).on("change, change.fs","#type-selector",function(e){var t=$(this);movietype=t.val(),makeSentence()}),$(document).on("change, keyup","#yearfrom",function(e){var t=$(this);""!=t.val()&&t.val().length>=4&&(yearfrom=t.val())}),$(document).on("change, keyup","#yearto",function(e){var t=$(this);""!=t.val()&&t.val().length>=4&&(yearto=t.val(),"undefined"!=typeof yearfrom&&yearfrom>yearto&&(yearto=yearfrom),("undefined"==typeof yearfrom||0==yearfrom)&&(yearfrom=yearto))}),$(document).on("click","#apply",function(e){makeSentence(),getCards()}),$("#geolocation-google-map").length>0){var o=$("#geolocation_address").val(),a=$("#geolocation_latitude").val(),n=$("#geolocation_longitude").val(),t=""==a&&""==n?new google.maps.LatLng(50.833,4.333):new google.maps.LatLng(a,n),r=new google.maps.Map(document.getElementById("geolocation-google-map"),{zoom:8,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:0,zoomControl:!0,mapTypeControl:0,scaleControl:!0,streetViewControl:0,overviewMapControl:0}),i=new google.maps.Marker({position:t,map:r,draggable:!0});r.addListener(i,"drag",function(){var e=i.getPosition();$("#geolocation_latitude").val(e.lat()),$("#geolocation_latitude_shown").val(e.lat()),$("#geolocation_longitude").val(e.lng()),$("#geolocation_longitude_shown").val(e.lng())}),$(document).on("change, keyup","#geolocation_address",function(e){var t=$(this);if(""!=t.val()&&t.val().length>=3){var o=new google.maps.Geocoder;o.geocode({address:t.val()},function(e,t){if(t==google.maps.GeocoderStatus.OK){var o=e[0].geometry.location;r.setCenter(o),i.setPosition(o),r.getZoom()<12&&r.setZoom(12),$("#geolocation-new-coordinates").show(),$("#geolocation_new_latitude").val(e[0].geometry.location.lat()),$("#geolocation_new_longitude").val(e[0].geometry.location.lng())}})}}),$(document).on("click","#geolocation-use-new",function(e){e.preventDefault(),$("#geolocation_latitude").val($("#geolocation_new_latitude").val()),$("#geolocation_latitude_shown").val($("#geolocation_new_latitude").val()),$("#geolocation_longitude").val($("#geolocation_new_longitude").val()),$("#geolocation_longitude_shown").val($("#geolocation_new_longitude").val())})}$(document).on("change","#single-slider",function(e){var t=$(this);t.is(":checked")?makeSingleSlider():makeDoubleSlider()}),$(function(){makeSingleSlider()})}),$(function(){handleResize(),$(window).resize(function(){handleResize()})}),getCards();