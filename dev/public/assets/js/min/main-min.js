function makeDoubleSlider(){$("#slider").children().length>0&&$("#slider").slider("destroy"),$("#slider").slider({range:!0,min:1980,max:2015,values:[2e3,2014],slide:function(e,o){yearfrom=o.values[0],yearto=o.values[1],makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom),$("#slider").find(".ui-slider-handle").last().text(yearto)},create:function(e,o){yearfrom=2e3,yearto=2014,makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom),$("#slider").find(".ui-slider-handle").last().text(yearto)}})}function makeSingleSlider(){$("#slider").children().length>0&&$("#slider").slider("destroy"),$("#slider").slider({min:1980,max:2015,value:2014,slide:function(e,o){yearfrom=o.value,yearto=o.value,makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom)},create:function(e,o){yearfrom=o.value,yearto=o.value,makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom)}})}function makeSentence(){var e="Votre recherche actuelle liste les films";yearfrom>0&&(e+=yearto>0?yearfrom==yearto?" en "+yearfrom:" entre "+yearfrom+" et "+yearto:" en "+yearfrom),category>0&&($categoryName=$("#category-selector-"+category).text(),e+=" dans la catÃ©gorie "+$categoryName),e+=".",$("#sentence").text(e),getCards()}function getCards(){$parameters={count:0},"undefined"!=typeof category&&category>0&&$.extend($parameters,{category:category}),"undefined"!=typeof lattop&&lattop>0&&$.extend($parameters,{lattop:lattop}),"undefined"!=typeof lngtop&&lngtop>0&&$.extend($parameters,{lngtop:lngtop}),"undefined"!=typeof latbottom&&latbottom>0&&$.extend($parameters,{latbottom:latbottom}),"undefined"!=typeof category&&category>0&&$.extend($parameters,{category:category}),"undefined"!=typeof lngbottom&&lngbottom>0&&$.extend($parameters,{lngbottom:lngbottom}),"undefined"!=typeof yearfrom&&yearfrom>0&&$.extend($parameters,{yearfrom:yearfrom}),"undefined"!=typeof yearto&&yearto>0&&$.extend($parameters,{yearto:yearto}),"undefined"!=typeof movietype&&0!=movietype&&$.extend($parameters,{movietype:movietype});var e,o;$.get("/rest/cards",$parameters,function(t){if(mapMarkers.length>0)for(o=0;o<mapMarkers.length;o++)mapMarkers[o].setMap(null);mapMarkers=[],markers=[],infowindows=[],hcData=[],$.each(t.cards,function(e,o){markers.push([o.title,o.location_lat,o.location_long]),cardIDs.push([o.id]),infowindows.push(['<h2><a class="slideRight" href="/cards/'+o.id+'">'+o.title+"</a></h2><p>"+o.description+"</p>"])});var a=new google.maps.InfoWindow;for(o=0;o<markers.length;o++){var n=new google.maps.LatLng(markers[o][1],markers[o][2]);hcData.push(n),bounds.extend(n),e=new google.maps.Marker({position:n,map:map,title:markers[o][0],icon:"assets/img/zoom-0.png"}),mapMarkers.push(e),google.maps.event.addListener(e,"click",function(e,o){return function(){console.log(cardIDs[o]),href="/cards/"+cardIDs[o],$("#slideRight .modal-body").load(href+" #content"),$("#slideRight").modal(),$(".modal").prop("class","modal fade"),$(".modal").modal("show")}}(e,o)),map.fitBounds(bounds)}var r={gridSize:50,maxZoom:15,styles:[{height:40,url:"assets/img/zoom-1.png",width:40},{height:56,url:"assets/img/zoom-2.png",width:56},{height:66,url:"assets/img/zoom-3.png",width:66},{height:78,url:"assets/img/zoom-4.png",width:78},{height:90,url:"assets/img/zoom-5.png",width:90}]};"undefined"!=typeof markerCluster&&markerCluster.clearMarkers(),markerCluster=new MarkerClusterer(map,mapMarkers,r),google.maps.event.addListener(markerCluster,"clusterclick",function(e){if(map.getZoom()>12){var o=e.getMarkers(),t="<ul>",a="";$.each(o,function(){m=$(this)[0];var e=$(mapMarkers).index(this),o=infowindows[e];t+="<li>"+o+"</li>",$("#slideRight .modal-body").html(t),$("#slideRight").modal()})}})})}(function(){var e;e=window.jQuery||window.Zepto||window.$,e.fn.fancySelect=function(o){var t,a;return null==o&&(o={}),a=e.extend({forceiOS:!1,includeBlank:!1,optionTemplate:function(e){return e.text()},triggerTemplate:function(e){return e.text()}},o),t=!!navigator.userAgent.match(/iP(hone|od|ad)/i),this.each(function(){var o,n,r,l,i,s,d;return l=e(this),l.hasClass("fancified")||"SELECT"!==l[0].tagName?void 0:(l.addClass("fancified"),l.css({width:1,height:1,display:"block",position:"absolute",top:0,left:0,opacity:0}),l.wrap('<div class="fancy-select">'),d=l.parent(),l.data("class")&&d.addClass(l.data("class")),d.append('<div class="trigger">'),(!t||a.forceiOS)&&d.append('<ul class="options">'),i=d.find(".trigger"),r=d.find(".options"),n=l.prop("disabled"),n&&d.addClass("disabled"),s=function(){var e;return e=a.triggerTemplate(l.find(":selected")),i.html(e)},l.on("blur.fs",function(){return i.hasClass("open")?setTimeout(function(){return i.trigger("close.fs")},120):void 0}),i.on("close.fs",function(){return i.removeClass("open"),r.removeClass("open")}),i.on("click.fs",function(){var o,s;if(!n)if(i.toggleClass("open"),t&&!a.forceiOS){if(i.hasClass("open"))return l.focus()}else if(i.hasClass("open")&&(s=i.parent(),o=s.offsetParent(),s.offset().top+s.outerHeight()+r.outerHeight()+20>e(window).height()+e(window).scrollTop()?r.addClass("overflowing"):r.removeClass("overflowing")),r.toggleClass("open"),!t)return l.focus()}),l.on("enable",function(){return l.prop("disabled",!1),d.removeClass("disabled"),n=!1,o()}),l.on("disable",function(){return l.prop("disabled",!0),d.addClass("disabled"),n=!0}),l.on("change.fs",function(e){return e.originalEvent&&e.originalEvent.isTrusted?e.stopPropagation():s()}),l.on("keydown",function(e){var o,t,a;if(a=e.which,o=r.find(".hover"),o.removeClass("hover"),r.hasClass("open")){if(38===a?(e.preventDefault(),o.length&&o.index()>0?o.prev().addClass("hover"):r.find("li:last-child").addClass("hover")):40===a?(e.preventDefault(),o.length&&o.index()<r.find("li").length-1?o.next().addClass("hover"):r.find("li:first-child").addClass("hover")):27===a?(e.preventDefault(),i.trigger("click.fs")):13===a||32===a?(e.preventDefault(),o.trigger("click.fs")):9===a&&i.hasClass("open")&&i.trigger("close.fs"),t=r.find(".hover"),t.length)return r.scrollTop(0),r.scrollTop(t.position().top-12)}else if(13===a||32===a||38===a||40===a)return e.preventDefault(),i.trigger("click.fs")}),r.on("click.fs","li",function(o){var a;return a=e(this),l.val(a.data("raw-value")),t||l.trigger("blur.fs").trigger("focus.fs"),r.find(".selected").removeClass("selected"),a.addClass("selected"),i.addClass("selected"),l.val(a.data("raw-value")).trigger("change.fs").trigger("blur.fs").trigger("focus.fs")}),r.on("mouseenter.fs","li",function(){var o,t;return t=e(this),o=r.find(".hover"),o.removeClass("hover"),t.addClass("hover")}),r.on("mouseleave.fs","li",function(){return r.find(".hover").removeClass("hover")}),o=function(){var o;return s(),!t||a.forceiOS?(o=l.find("option"),l.find("option").each(function(o,t){var n;return t=e(t),t.prop("disabled")||!t.val()&&!a.includeBlank?void 0:(n=a.optionTemplate(t),r.append(t.prop("selected")?'<li data-raw-value="'+t.val()+'" class="selected">'+n+"</li>":'<li data-raw-value="'+t.val()+'">'+n+"</li>"))})):void 0},l.on("update.fs",function(){return d.find(".options").empty(),o()}),o())})}}).call(this),jQuery(document).ready(function($){$(".custom-select").fancySelect()});var category=0,yearfrom=0,yearto=0,lattop=0,lngtop=0,latbottom=0,lngbottom=0,movietype=0,map,markers=[],mapMarkers=[],cardIDs=[],infowindows,bounds=new google.maps.LatLngBounds,mapOptions={mapTypeId:"roadmap"},heatmap,hcData=[],markerCluster;jQuery(function(){var e=[{stylers:[{visibility:"simplified"}]},{stylers:[{color:"#121212"}]},{featureType:"water",stylers:[{color:"#121212"},{lightness:0}]},{featureType:"landscape",stylers:[{color:"#121212"},{lightness:35}]},{elementType:"labels.text.fill",stylers:[{visibility:"on"},{lightness:100}]}];$=jQuery.noConflict(),$ajaxLoader='<div class="ajax-loader"></div>';var o=new google.maps.LatLng(50.833,4.333);if(map=new google.maps.Map(document.getElementById("google-map"),{zoom:4,center:o,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:0,zoomControl:!0,mapTypeControl:0,maxZoom:13,scaleControl:!0,streetViewControl:0,styles:e,overviewMapControl:0}),$(document).on("click",".ajax",function(e){e.preventDefault();var o=$(this);return href=o.attr("href"),$("#ajax .modal-body").load(href+" #content"),$("#ajax").modal(),!1}),$(document).on("click",".slideRight",function(e){var o=$(this);return href=o.attr("href"),$("#slideRight .modal-body").load(href+" #content"),$("#slideRight").modal(),!1}),$(document).on("click",".addCard",function(e){return e.preventDefault(),$("#addCard").modal(),!1}),$(document).on("change, change.fs","#category-selector",function(e){var o=$(this);category=o.val(),makeSentence()}),$(document).on("change, change.fs","#type-selector",function(e){var o=$(this);movietype=o.val(),makeSentence()}),$(document).on("change, keyup","#yearfrom",function(e){var o=$(this);""!=o.val()&&o.val().length>=4&&(yearfrom=o.val())}),$(document).on("change, keyup","#yearto",function(e){var o=$(this);""!=o.val()&&o.val().length>=4&&(yearto=o.val(),"undefined"!=typeof yearfrom&&yearfrom>yearto&&(yearto=yearfrom),("undefined"==typeof yearfrom||0==yearfrom)&&(yearfrom=yearto))}),$(document).on("click","#apply",function(e){makeSentence(),getCards()}),$("#geolocation_address").length){var t=$("#geolocation_address").val(),a=$("#geolocation_latitude").val(),n=$("#geolocation_longitude").val(),o=""==a&&""==n?new google.maps.LatLng(50.833,4.333):new google.maps.LatLng(a,n),r=new google.maps.Map(document.getElementById("geolocation-google-map"),{zoom:8,center:o,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:0,zoomControl:!0,mapTypeControl:0,scaleControl:!0,streetViewControl:0,overviewMapControl:0}),l=new google.maps.Marker({position:o,map:r,draggable:!0});r.addListener(l,"drag",function(){var e=l.getPosition();$("#geolocation_latitude").val(e.lat()),$("#geolocation_latitude_shown").val(e.lat()),$("#geolocation_longitude").val(e.lng()),$("#geolocation_longitude_shown").val(e.lng())}),$(document).on("change, keyup","#geolocation_address",function(e){var o=$(this);if(""!=o.val()&&o.val().length>=3){var t=new google.maps.Geocoder;t.geocode({address:o.val()},function(e,o){if(o==google.maps.GeocoderStatus.OK){var t=e[0].geometry.location;r.setCenter(t),l.setPosition(t),map.getZoom()<12&&map.setZoom(12),$("#geolocation-new-coordinates").show(),$("#geolocation_new_latitude").val(e[0].geometry.location.lat()),$("#geolocation_new_longitude").val(e[0].geometry.location.lng())}})}}),$(document).on("click","#geolocation-use-new",function(e){e.preventDefault(),$("#geolocation_latitude").val($("#geolocation_new_latitude").val()),$("#geolocation_latitude_shown").val($("#geolocation_new_latitude").val()),$("#geolocation_longitude").val($("#geolocation_new_longitude").val()),$("#geolocation_longitude_shown").val($("#geolocation_new_longitude").val())})}$(document).on("change","#single-slider",function(e){var o=$(this);o.is(":checked")?makeSingleSlider():makeDoubleSlider()}),$(function(){makeSingleSlider()})}),getCards();