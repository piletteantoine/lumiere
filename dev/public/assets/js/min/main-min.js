function makeDoubleSlider(){$("#slider").children().length>0&&$("#slider").slider("destroy"),$("#slider").slider({range:!0,min:1980,max:2015,values:[2e3,2014],slide:function(e,a){yearfrom=a.values[0],yearto=a.values[1],makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom),$("#slider").find(".ui-slider-handle").last().text(yearto)},create:function(e,a){yearfrom=2e3,yearto=2014,makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom),$("#slider").find(".ui-slider-handle").last().text(yearto)}})}function makeSingleSlider(){$("#slider").children().length>0&&$("#slider").slider("destroy"),$("#slider").slider({min:1980,max:2015,value:2014,slide:function(e,a){yearfrom=a.value,yearto=a.value,makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom)},create:function(e,a){yearfrom=a.value,yearto=a.value,makeSentence(),$("#slider").find(".ui-slider-handle").first().text(yearfrom)}})}function makeSentence(){var e="Votre recherche actuelle liste les films";yearfrom>0&&(e+=yearto>0?yearfrom==yearto?" en "+yearfrom:" entre "+yearfrom+" et "+yearto:" en "+yearfrom),category>0&&($categoryName=$("#category-selector-"+category).text(),e+=" dans la catÃ©gorie "+$categoryName),e+=".",$("#sentence").text(e),getCards()}function getCards(){$parameters={count:0},"undefined"!=typeof category&&category>0&&$.extend($parameters,{category:category}),"undefined"!=typeof lattop&&lattop>0&&$.extend($parameters,{lattop:lattop}),"undefined"!=typeof lngtop&&lngtop>0&&$.extend($parameters,{lngtop:lngtop}),"undefined"!=typeof latbottom&&latbottom>0&&$.extend($parameters,{latbottom:latbottom}),"undefined"!=typeof category&&category>0&&$.extend($parameters,{category:category}),"undefined"!=typeof lngbottom&&lngbottom>0&&$.extend($parameters,{lngbottom:lngbottom}),"undefined"!=typeof yearfrom&&yearfrom>0&&$.extend($parameters,{yearfrom:yearfrom}),"undefined"!=typeof yearto&&yearto>0&&$.extend($parameters,{yearto:yearto}),"undefined"!=typeof movietype&&0!=movietype&&$.extend($parameters,{movietype:movietype});var e,a;$.get("/rest/cards",$parameters,function(t){if(mapMarkers.length>0)for(a=0;a<mapMarkers.length;a++)mapMarkers[a].setMap(null);mapMarkers=[],markers=[],infowindows=[],hcData=[],$.each(t.cards,function(e,a){markers.push([a.title,a.location_lat,a.location_long]),cardIDs.push([a.id]),infowindows.push(['<h2><a class="slideRight" href="/cards/'+a.id+'">'+a.title+"</a></h2><p>"+a.description+"</p>"])});var o=new google.maps.InfoWindow;for(a=0;a<markers.length;a++){var r=new google.maps.LatLng(markers[a][1],markers[a][2]);hcData.push(r),bounds.extend(r),e=new google.maps.Marker({position:r,map:map,title:markers[a][0],icon:"assets/img/zoom-0.png"}),mapMarkers.push(e),google.maps.event.addListener(e,"click",function(e,a){return function(){console.log(cardIDs[a]),href="/cards/"+cardIDs[a],$("#slideRight .modal-body").load(href+" #content"),$("#slideRight").modal(),$(".modal").prop("class","modal fade"),$(".modal").modal("show")}}(e,a)),map.fitBounds(bounds)}var n={gridSize:50,maxZoom:15,styles:[{height:40,url:"assets/img/zoom-1.png",width:40},{height:56,url:"assets/img/zoom-2.png",width:56},{height:66,url:"assets/img/zoom-3.png",width:66},{height:78,url:"assets/img/zoom-4.png",width:78},{height:90,url:"assets/img/zoom-5.png",width:90}]};"undefined"!=typeof markerCluster&&markerCluster.clearMarkers(),markerCluster=new MarkerClusterer(map,mapMarkers,n),google.maps.event.addListener(markerCluster,"clusterclick",function(e){if(map.getZoom()>12){var a=e.getMarkers(),t="<ul>",o="";$.each(a,function(){m=$(this)[0];var e=$(mapMarkers).index(this),a=infowindows[e];t+="<li>"+a+"</li>",$("#slideRight .modal-body").html(t),$("#slideRight").modal()})}});var l=new google.maps.MVCArray(hcData);"undefined"!=typeof heatmap&&heatmap.setMap(null),heatmap=new google.maps.visualization.HeatmapLayer({data:l}),heatmap.setMap(map);var i=["rgba(170, 170, 170, 0)","rgba(175, 175, 175, 0.1)","rgba(180, 180, 180, 0.2)","rgba(185, 185, 185, 0.2)","rgba(190, 190, 190, 0.3)","rgba(195, 195, 195, 0.3)","rgba(200, 200, 200, 0.3)","rgba(215, 215, 215, 0.4)","rgba(220, 220, 220, 0.5)","rgba(225, 225, 225, 0.6)","rgba(230, 230, 230, 0.7)","rgba(235, 235, 235, 0.8)","rgba(245, 245, 245, 0.9)","rgba(255, 255, 255, 1)"];heatmap.set("gradient",i),heatmap.set("radius",40)})}(function(){var e;e=window.jQuery||window.Zepto||window.$,e.fn.fancySelect=function(a){var t,o;return null==a&&(a={}),o=e.extend({forceiOS:!1,includeBlank:!1,optionTemplate:function(e){return e.text()},triggerTemplate:function(e){return e.text()}},a),t=!!navigator.userAgent.match(/iP(hone|od|ad)/i),this.each(function(){var a,r,n,l,i,s,d;return l=e(this),l.hasClass("fancified")||"SELECT"!==l[0].tagName?void 0:(l.addClass("fancified"),l.css({width:1,height:1,display:"block",position:"absolute",top:0,left:0,opacity:0}),l.wrap('<div class="fancy-select">'),d=l.parent(),l.data("class")&&d.addClass(l.data("class")),d.append('<div class="trigger">'),(!t||o.forceiOS)&&d.append('<ul class="options">'),i=d.find(".trigger"),n=d.find(".options"),r=l.prop("disabled"),r&&d.addClass("disabled"),s=function(){var e;return e=o.triggerTemplate(l.find(":selected")),i.html(e)},l.on("blur.fs",function(){return i.hasClass("open")?setTimeout(function(){return i.trigger("close.fs")},120):void 0}),i.on("close.fs",function(){return i.removeClass("open"),n.removeClass("open")}),i.on("click.fs",function(){var a,s;if(!r)if(i.toggleClass("open"),t&&!o.forceiOS){if(i.hasClass("open"))return l.focus()}else if(i.hasClass("open")&&(s=i.parent(),a=s.offsetParent(),s.offset().top+s.outerHeight()+n.outerHeight()+20>e(window).height()+e(window).scrollTop()?n.addClass("overflowing"):n.removeClass("overflowing")),n.toggleClass("open"),!t)return l.focus()}),l.on("enable",function(){return l.prop("disabled",!1),d.removeClass("disabled"),r=!1,a()}),l.on("disable",function(){return l.prop("disabled",!0),d.addClass("disabled"),r=!0}),l.on("change.fs",function(e){return e.originalEvent&&e.originalEvent.isTrusted?e.stopPropagation():s()}),l.on("keydown",function(e){var a,t,o;if(o=e.which,a=n.find(".hover"),a.removeClass("hover"),n.hasClass("open")){if(38===o?(e.preventDefault(),a.length&&a.index()>0?a.prev().addClass("hover"):n.find("li:last-child").addClass("hover")):40===o?(e.preventDefault(),a.length&&a.index()<n.find("li").length-1?a.next().addClass("hover"):n.find("li:first-child").addClass("hover")):27===o?(e.preventDefault(),i.trigger("click.fs")):13===o||32===o?(e.preventDefault(),a.trigger("click.fs")):9===o&&i.hasClass("open")&&i.trigger("close.fs"),t=n.find(".hover"),t.length)return n.scrollTop(0),n.scrollTop(t.position().top-12)}else if(13===o||32===o||38===o||40===o)return e.preventDefault(),i.trigger("click.fs")}),n.on("click.fs","li",function(a){var o;return o=e(this),l.val(o.data("raw-value")),t||l.trigger("blur.fs").trigger("focus.fs"),n.find(".selected").removeClass("selected"),o.addClass("selected"),i.addClass("selected"),l.val(o.data("raw-value")).trigger("change.fs").trigger("blur.fs").trigger("focus.fs")}),n.on("mouseenter.fs","li",function(){var a,t;return t=e(this),a=n.find(".hover"),a.removeClass("hover"),t.addClass("hover")}),n.on("mouseleave.fs","li",function(){return n.find(".hover").removeClass("hover")}),a=function(){var a;return s(),!t||o.forceiOS?(a=l.find("option"),l.find("option").each(function(a,t){var r;return t=e(t),t.prop("disabled")||!t.val()&&!o.includeBlank?void 0:(r=o.optionTemplate(t),n.append(t.prop("selected")?'<li data-raw-value="'+t.val()+'" class="selected">'+r+"</li>":'<li data-raw-value="'+t.val()+'">'+r+"</li>"))})):void 0},l.on("update.fs",function(){return d.find(".options").empty(),a()}),a())})}}).call(this),jQuery(document).ready(function($){$(".custom-select").fancySelect()});var category=0,yearfrom=0,yearto=0,lattop=0,lngtop=0,latbottom=0,lngbottom=0,movietype=0,map,markers=[],mapMarkers=[],cardIDs=[],infowindows,bounds=new google.maps.LatLngBounds,mapOptions={mapTypeId:"roadmap"},heatmap,hcData=[],markerCluster;jQuery(function(){var e=[{stylers:[{visibility:"simplified"}]},{stylers:[{color:"#121212"}]},{featureType:"water",stylers:[{color:"#121212"},{lightness:0}]},{featureType:"landscape",stylers:[{color:"#121212"},{lightness:35}]},{elementType:"labels.text.fill",stylers:[{visibility:"on"},{lightness:100}]}];$=jQuery.noConflict(),$ajaxLoader='<div class="ajax-loader"></div>';var a=new google.maps.LatLng(50.833,4.333);if(map=new google.maps.Map(document.getElementById("google-map"),{zoom:3,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:0,zoomControl:!0,mapTypeControl:0,maxZoom:13,scaleControl:!0,streetViewControl:0,styles:e,overviewMapControl:0}),$(document).on("click",".ajax",function(e){e.preventDefault();var a=$(this);return href=a.attr("href"),$("#ajax .modal-body").load(href+" #content"),$("#ajax").modal(),!1}),$(document).on("click",".slideRight",function(e){var a=$(this);return href=a.attr("href"),$("#slideRight .modal-body").load(href+" #content"),$("#slideRight").modal(),!1}),$(document).on("click",".addCard",function(e){return e.preventDefault(),$("#addCard").modal(),!1}),$(document).on("change","#category-selector",function(e){var a=$(this);category=a.val(),makeSentence()}),$(document).on("change","#type-selector",function(e){var a=$(this);movietype=a.val(),makeSentence()}),$(document).on("change, keyup","#yearfrom",function(e){var a=$(this);""!=a.val()&&a.val().length>=4&&(yearfrom=a.val())}),$(document).on("change, keyup","#yearto",function(e){var a=$(this);""!=a.val()&&a.val().length>=4&&(yearto=a.val(),"undefined"!=typeof yearfrom&&yearfrom>yearto&&(yearto=yearfrom),("undefined"==typeof yearfrom||0==yearfrom)&&(yearfrom=yearto))}),$(document).on("click","#apply",function(e){makeSentence(),getCards()}),$("#geolocation_address").length){var t=$("#geolocation_address").val(),o=$("#geolocation_latitude").val(),r=$("#geolocation_longitude").val(),a=""==o&&""==r?new google.maps.LatLng(50.833,4.333):new google.maps.LatLng(o,r),n=new google.maps.Map(document.getElementById("geolocation-google-map"),{zoom:8,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:0,zoomControl:!0,mapTypeControl:0,scaleControl:!0,streetViewControl:0,overviewMapControl:0}),l=new google.maps.Marker({position:a,map:n,draggable:!0});n.addListener(l,"drag",function(){var e=l.getPosition();$("#geolocation_latitude").val(e.lat()),$("#geolocation_latitude_shown").val(e.lat()),$("#geolocation_longitude").val(e.lng()),$("#geolocation_longitude_shown").val(e.lng())}),$(document).on("change, keyup","#geolocation_address",function(e){var a=$(this);if(""!=a.val()&&a.val().length>=3){var t=new google.maps.Geocoder;t.geocode({address:a.val()},function(e,a){if(a==google.maps.GeocoderStatus.OK){var t=e[0].geometry.location;n.setCenter(t),l.setPosition(t),map.getZoom()<12&&map.setZoom(12),$("#geolocation-new-coordinates").show(),$("#geolocation_new_latitude").val(e[0].geometry.location.lat()),$("#geolocation_new_longitude").val(e[0].geometry.location.lng())}})}}),$(document).on("click","#geolocation-use-new",function(e){e.preventDefault(),$("#geolocation_latitude").val($("#geolocation_new_latitude").val()),$("#geolocation_latitude_shown").val($("#geolocation_new_latitude").val()),$("#geolocation_longitude").val($("#geolocation_new_longitude").val()),$("#geolocation_longitude_shown").val($("#geolocation_new_longitude").val())})}$(document).on("change","#single-slider",function(e){var a=$(this);a.is(":checked")?makeSingleSlider():makeDoubleSlider()}),$(function(){makeSingleSlider()})}),getCards();